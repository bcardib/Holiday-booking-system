<!DOCTYPE html>
<html lang="en">

<head>
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <title>Home</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .header {
            display: flex; 
            align-items: center;
            justify-content: space-around; 
            background-color: #24283b;
            margin-top: 20px; 
            padding: 20px 10px;
            border-radius: 20px; 
            color: white;
        }

        .header a {
            color: rgb(255, 255, 255);
            text-align: center;
            font-family: Montserrat;
            padding: 12px;
            text-decoration: none;
            font-size: 18px;
            line-height: 25px;
            border-radius: 4px;
            border-bottom: 1px solid #4c566a; 
        }

        .welcome-header {
            display: inline;
            font-size: 25px;
            font-weight: bold;  
        } 

        .header a.logo {
            font-size: 25px;
            font-weight: bold;
            background-color: #6a5acd;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;       
        }
        
        .header a:hover {
            background-color: #ddd;
            color: black;
        }
        
        .header a.active {
            background-color: #6a5acd;
            color: white;
        }
        
        .header-right {
            display: inline;
            float: right;
        }

        body {
            display: grid;
            grid-template-rows: auto 1fr;
            grid-template-columns: 0.1fr minmax(200px, 1fr) 0.1fr;
            grid-template-areas: 
                "sidebar-left header sidebar-right"
                "sidebar-left main sidebar-right";
            height: 100vh;
            font-family: Montserrat;
            background-color: #201c24;
        }
        
        .sidebar {
            background-color: #201c24;
            padding: 20px;
        }
        
        .sidebar-left {
            grid-area: sidebar-left;
        }
        
        .sidebar-right {
            grid-area: sidebar-right;
        }
        
        .main {
            display: grid;
            gap: 20px;
            grid-template-columns: 1.5fr 8.5fr;
            padding: 20px;
            background-color: #201c24;
        }

        .blog-section {
            background-color: #2e3440; 
            display: grid; 
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            background-color: #24283b;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            z-index: 1;
        }
        
        .blog-section-title {
            color: white;
            text-align: left;
            font-family: Montserrat;
            font-size: 28px;
            margin-bottom: 20px;
            z-index: 1;
        }
        
        .blog-container {
            background-color: #2e3440; 
            color: white;
            border: 1px solid #4c566a;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            text-decoration: none;
            z-index: 1;
        }
        
        .blog-title {
            display: flex;
            justify-content: space-between;
            font-size: 30px;
            font-weight: bold;
            margin-bottom: 10px;
            margin-top: 5px;
        }
        
        .blog-content {
            font-size: 16px;
            text-align: right;
        }

        .blog-date, .blog-author {
            font-size: 14px;
            color: #888;
        }

        .blog-container:hover  {
            background-color: #3b4252;
            box-shadow: 0 4px 8px rgba(0,0,0,0.6); 
        }

        .blog-price {
            text-align: right;
            font-size: 24px;
            font-weight: bold;
        }

        .blog-duration {
            text-align: right;
            font-size: 16px;
        }

        .blog-info {
            padding-right: 17%;
        }

        .tag-container {
            display: flex;
            flex-direction: column; 
            background-color: #2e3440; 
            color: white;
            border: 1px solid #4c566a;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            text-decoration: none;
            z-index: 1;        
        }

        .tag-container div {
            font-size: 16px;
            padding: 5px;
        }

        .tag-section-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .blog-image {
            width: 100%; 
            height: auto; 
            border-radius: 10px; 
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .admin-container {
            display: flex;
            flex-direction: column; 
            background-color: #2e3440; 
            color: white;
            border: 1px solid #4c566a;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            text-decoration: none;
            z-index: 1;       
        }

        .package-btn {
            border-radius: 5px; 
            margin-bottom: 10px;
            padding: 7px 20px;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
            font-family: Montserrat;
        }

        .package-btn:hover {
            background-color: #6a5acd;
            border-color: #6a5acd;
            font-family: Montserrat;
            color: white;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        /* Add additional styles as necessary */

    </style>
</head>

<body>
    <header class="header">
        <a href="login" class="logo">HolidayPlanner <span class="material-symbols-outlined"> travel_explore </span> </a> 
        <span class="welcome-header">Welcome back {{ username }}!</span>
        <div class="header-right">
          <a class="active" href="/">Home</a>
          <a href="/">Flights</a>
          <a href="/">Accommodation</a>
          <a href="/">Contact</a>
          <a href="{{ url_for('checkout') }}" class="checkout-btn">Checkout</a> <!-- Checkout link -->
          <span id="cart-count">0</span> <!-- Display cart count -->
        </div>
    </header> 

    <aside class="sidebar sidebar-left"></aside>

    <div class="main">
        <div id="modal-backdrop" class="modal-backdrop"></div>

        <div id="create-package-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Package</h5>
                </div>
                <form id="post-package-form">
                    <label for="admin-titles">Package Title</label>
                    <input type="text" id="package-title" required>

                    <label for="admin-titles">Package Content</label>
                    <textarea id="package-content" required></textarea>

                    <label for="admin-titles">Package Category</label>
                    <select id="package-category" name="category">
                        <option value="">Please select a category</option>
                        <option value="Beach Holidays">Beach Holidays</option>
                        <option value="City Break">City Break</option>
                        <option value="Countryside">Countryside</option>
                    </select>

                    <label for="admin-titles">Package Price</label>
                    <input type="number" id="package-price" placeholder="500" required>

                    <label for="admin-titles">Package Duration</label>
                    <select id="package-duration" name="duration">
                        <option value="">Please select the duration</option>
                        <option value="1 Night">1 Night</option>
                        <option value="5 Nights">5 Nights</option>
                        <option value="1 Week">1 Week</option>
                        <option value="2 Weeks">2 Weeks</option>
                    </select>      

                    <label for="admin-titles">Package Image</label>              
                    <input type="text" id="package-image" placeholder="Image Link" required>
                </form>
                <div id="incorrect-package-creation" class="incorrect-package-creation"></div>

                <div class="modal-form-buttons">
                    <button type="button" class="modal-btn" onclick="createPackage()">Create Package</button>
                    <button type="button" class="modal-btn" onclick="closeModal('create-package-modal')">Close</button>
                </div>
            </div>
        </div> 

        <!-- Edit Package Modal -->
        <div id="edit-package-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Package</h5>
                    <div id="edit-id" class="edit-id"></div> 
                    <div>
                        <button type="button" class="edit-modal-btn" onclick="down()"> Down </button>
                        <button type="button" class="edit-modal-btn" onclick="up()"> Up </button>
                    </div>
                </div>

                <form id="post-package-form">
                    <label for="admin-titles">Package Title</label>
                    <input type="text" id="edit-package-title">

                    <label for="admin-titles">Package Content</label>
                    <textarea id="edit-package-content"></textarea>

                    <label for="admin-titles">Package Category</label>
                    <select id="edit-package-category" name="category">
                        <option value="">Please select a category</option>
                        <option value="Beach Holidays">Beach Holidays</option>
                        <option value="City Break">City Break</option>
                        <option value="Countryside">Countryside</option>
                    </select>

                    <label for="admin-titles">Package Price</label>
                    <input type="number" id="edit-package-price" placeholder="500">

                    <label for="admin-titles">Package Duration</label>
                    <select id="edit-package-duration" name="duration">
                        <option value="">Please select the duration</option>
                        <option value="1 Night">1 Night</option>
                        <option value="5 Nights">5 Nights</option>
                        <option value="1 Week">1 Week</option>
                        <option value="2 Weeks">2 Weeks</option>
                    </select>      

                    <label for="admin-titles">Package Image</label>              
                    <input type="text" id="edit-package-image" placeholder="Image Link" required>
                </form>
                <div id="incorrect-package-creation" class="incorrect-package-creation"></div>

                <div class="modal-form-buttons">
                    <button type="button" class="modal-btn" onclick="editPackage(packages[currentIndex])">Edit Package</button>
                    <button type="button" class="modal-btn" onclick="closeModal('edit-package-modal')">Close</button>
                </div>
            </div>
        </div> 

        <!-- Delete Package Modal -->
        <div id="delete-package-modal" class="modal">
            <div class="modal-content-delete">
                <div class="modal-header-delete">
                    <h5 class="modal-title">Delete Package</h5>
                    <label for="admin-titles">Package ID</label>
                    <input type="text" id="delete-package-id">
                </div>

                <div class="modal-form-buttons-delete">
                    <button type="button" class="modal-btn" onclick="deletePackage()">Delete Package</button>
                    <button type="button" class="modal-btn" onclick="closeModal('delete-package-modal')">Close</button>
                </div>
            </div>
        </div>

        <!-- Tags Section -->
        <div class="tags">
            <div id="tag-container" class="tag-container">
                <h1 id="tag-section-title" class="tag-section-title">Category</h1>
                <div>
                    <label>
                        <input type="checkbox" name="category" value="Beach Holidays" checked> Beach Holidays
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox" name="category" value="City Break" checked> City Break
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox" name="category" value="Countryside" checked> Countryside
                    </label>
                </div>

                <h1 id="tag-section-title" class="tag-section-title">Price Range</h1>
                <label for="min-price">Min Price: <span id="min-display">$0</span></label>
                <input type="range" id="min-price" min="0" max="1000" value="0" oninput="updatePriceRange()">

                <label for="max-price">Max Price: <span id="max-display">$1000</span></label>
                <input type="range" id="max-price" min="0" max="1000" value="1000" oninput="updatePriceRange()">
                
                <h1 id="tag-section-title" class="tag-section-title">Duration</h1>
                <div>
                    <input type="checkbox" id="1 Night" name="duration" value="1 Night">
                    <label for="1 Night">1 Night</label>
                </div> 
                <div>
                    <input type="checkbox" id="5 Nights" name="duration" value="5 Nights">
                    <label for="5 Nights">5 Nights</label>
                </div> 
                <div>
                    <input type="checkbox" id="1 Week" name="duration" value="1 Week">
                    <label for="1 Week">1 Week</label> 
                </div> 
                <div>
                    <input type="checkbox" id="2 Weeks" name="duration" value="2 Weeks">
                    <label for="2 Weeks">2 Weeks</label>      
                </div> 
            </div>

            {% if role == 'admin' %} <!-- Checks if user is admin. Displays div if so -->
            <div id="admin-container" class="admin-container">
                <h1 id="tag-section-title" class="tag-section-title">Admin</h1>
                <button id="create-package-modal" class="package-btn">Create Package</button>  
                <button id="edit-package-modal" onclick="fetchEditBlog()" class="package-btn">Edit Package</button>  
                <button id="delete-package-modal" class="package-btn">Delete Package</button>
            </div>
            {% endif %}
        </div>          

        <div class="content">
            <h1 id="blog-section-title" class="blog-section-title">Packages</h1>
            <div id="blog-section" class="blog-section"></div>
        </div>
    </div>

    <aside class="sidebar sidebar-right"></aside>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/static/js/libs/socket.io.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

    <script>
        let username = "{{ username }}";
        let role = "{{ role }}";
        let cart = [];  // Array to hold cart items

        $(document).ready(() => {
            fetchPackages();
            updatePriceRange();
            setupModalButton();
            fetchEditBlog();
        });

        // Add to Cart Function
        function addToCart(packageId, packageTitle, packagePrice) {
            const cartItem = {
                id: packageId,
                title: packageTitle,
                price: packagePrice
            };

            cart.push(cartItem);
            console.log(`${packageTitle} added to cart.`);
            updateCartUI();
        }

        // Update Cart UI Function
        function updateCartUI() {
            const cartCount = document.getElementById('cart-count'); 
            if (cartCount) {
                cartCount.textContent = cart.length; // Update cart count
            }
        }

        // Fetch Blog Packages Function
        function fetchBlog(categories, minPrice, maxPrice, durations) {
            const url = new URL('/packages', window.location.origin);
            if (categories.length > 0) {
                url.searchParams.append('category', categories.join(','));
            }
            if (minPrice !== undefined) {
                url.searchParams.append('min', minPrice);
            }
            if (maxPrice !== undefined) {
                url.searchParams.append('max', maxPrice);
            }
            if (durations.length > 0) {
                url.searchParams.append('duration', durations.join(','));
            }
        
            fetch(url) 
                .then(response => response.json())
                .then(packages => {
                    const blogContainer = document.getElementById('blog-section');
                    blogContainer.innerHTML = ''; 
                    packages.forEach(package => {  
                        const blogHtml = `
                            <div class="blog-container">
                                <img src="${package.image}" alt="${package.title}" class="blog-image"> 
                                <div class="blog-title">${package.title}
                                    <div class="blog-content">${package.content}</div>
                                </div>
                                <div class="blog-info">${package.category}</div>
                                <div class="blog-duration">${package.duration}</div>
                                <div class="blog-price">$${package.price} pp.</div>
                                <button class="add-to-cart-btn" onclick="addToCart('${package.id}', '${package.title}', ${package.price})">Add to Cart</button>
                            </div>
                        `;
                        blogContainer.insertAdjacentHTML('beforeend', blogHtml);
                    });
                })
                .catch(error => console.error('Error loading Blogs:', error));
        }

        // Other existing functions
        function getCategories() {
            const checkboxes = document.querySelectorAll('input[name="category"]:checked');
            return Array.from(checkboxes).map(checkbox => checkbox.value);
        }

        function getDurations() {
            const checkboxesDur = document.querySelectorAll('input[name="duration"]:checked');
            return Array.from(checkboxesDur).map(checkbox => checkbox.value);
        }

        function fetchPackages() {
            const categories = getCategories();
            const durations = getDurations();
            const minPrice = document.getElementById('min-price').value;
            const maxPrice = document.getElementById('max-price').value;
            fetchBlog(categories, minPrice, maxPrice, durations);
        }

        // Existing modal functions and event listeners
        const checkboxesCat = document.querySelectorAll('input[name="category"]');
        checkboxesCat.forEach(checkbox => {
            checkbox.addEventListener('change', fetchPackages);
        });

        const checkboxesDur = document.querySelectorAll('input[name="duration"]');
        checkboxesDur.forEach(checkbox => {
            checkbox.addEventListener('change', fetchPackages);
        });

        function setupModalButton() {
            var allButtons = document.querySelectorAll(".package-btn");
            allButtons.forEach(function(btn) {
                btn.addEventListener('click', function() {
                    var modalSelection = btn.getAttribute('id');
                    showPostModal(modalSelection);
                });
            });
        }

        function showPostModal(modalSelection) {
            var modal = document.getElementById(modalSelection);
            var backdrop = document.getElementById('modal-backdrop');
            if (modal) {
                modal.style.display = 'block';
                backdrop.style.display = 'block';
            } else {
                console.error('Modal element not found!');
            }
        }

        function closeModal(currModal) {
            var modal = document.getElementById(currModal);
            var backdrop = document.getElementById('modal-backdrop');
            if (modal) {
                modal.style.display = 'none';
                backdrop.style.display = 'none';
            } else {
                console.error('Modal element not found!');
            }
        }
    </script>
</body>
</html>
